---
layout: post
title:  使用Selenium处理浏览器选项卡
category: java
copyright: java
excerpt: Java
---

## 1.概述

[nudge4j](https://lorenzoongithub.github.io/nudge4j/)允许开发人员直接查看任何操作的影响，并提供一个环境，他们可以在其中探索、学习并最终花更少的时间调试和重新部署他们的应用程序。

在本文中，我们将探索nudge4j是什么、它是如何工作的，以及开发中的任何Java应用程序如何从中受益。

## 2.nudge4j是如何工作的

### 2.1.伪装的REPL

nudge4j本质上是一个读取-评估-打印-循环(REPL)，你可以在其中通过一个仅包含两个元素的简单页面在浏览器窗口中与你的Java应用程序对话：

-   一位编辑
-   在JVM按钮上执行

[![nudge4j.in_.action](https://www.baeldung.com/wp-content/uploads/2017/02/nudge4j.in_.action.499x439.png)](https://www.baeldung.com/wp-content/uploads/2017/02/nudge4j.in_.action.499x439.png)

你可以在典型的REPL周期中与你的JVM对话：

-   在编辑器中输入任何代码，然后在JVM上按执行
-   浏览器将代码发布到你的JVM，然后运行该代码
-   结果返回(作为字符串)并显示在按钮下方

nudge4j附带了一些可以直接尝试的示例，比如查询JVM运行了多长时间以及当前有多少内存可用。我建议你在编写自己的代码之前先从这些开始。

### 2.2.JavaScript引擎

浏览器发送给JVM的代码是操纵Java对象的JavaScript(不要与浏览器上运行的任何JavaScript混淆)。JavaScript由内置的JavaScript引擎[Nashorn](http://openjdk.java.net/projects/nashorn/)执行。

如果你不了解(或不喜欢)JavaScript，请不要担心–对于你的nudge4j需求，你可以将其视为一种无类型的Java方言。

请注意，我知道说“JavaScript是无类型的Java”是一个巨大的简化。但我希望Java开发人员(他们可能对JavaScript有偏见)给nudge4j一个公平的机会。

### 2.3.JVM交互的范围

nudge4j允许你访问任何可从JVM访问的Java类，允许你调用方法、创建对象等。这非常强大，但在处理你的应用程序时可能还不够。

在某些情况下，你可能希望访问一个或多个仅特定于你的应用程序的对象，以便你可以操作它们。nudge4j允许这样做。任何需要公开的对象都可以在实例化时作为参数传递。

### 2.4.异常处理

nudge4j的设计认识到该工具的用户可能会犯错误或导致JVM出错的可能性。在这两种情况下，该工具都旨在报告完整的堆栈跟踪，以指导用户纠正错误或错误。

让我们看一下屏幕截图，其中已执行的一段代码导致抛出异常：

## [![nudge4j.异常](https://www.baeldung.com/wp-content/uploads/2017/02/nudge4j.exception.488x711.png)](https://www.baeldung.com/wp-content/uploads/2017/02/nudge4j.exception.488x711.png)

## 3.将nudge4j添加到你的应用程序

### 3.1.只需复制和粘贴

与nudge4j的集成有些不同寻常，因为没有要添加到类路径的jar文件，也没有要添加到Maven或Gradle构建的依赖项。

相反，你需要简单地复制一小段Java代码(大约100行)并将其粘贴到你自己的代码中，然后再运行它。

[你会在nudge4j主页](https://lorenzoongithub.github.io/nudge4j/)上找到该片段——页面上什至有一个按钮，你可以单击该按钮将片段复制到剪贴板。

这段代码初看起来可能很深奥。有几个原因：

-   nudge4j片段可以放入任何类；因此，它不能对import做任何假设，并且它包含的任何类都必须是完全合格的
-   为了避免与已经定义的变量发生潜在的冲突，代码被包装在一个函数中
-   对内置JDKHttpServer 的访问是通过内省来完成的，以避免某些 IDE(例如 Eclipse)对以“ com.sun.”开头的包存在的限制

因此，即使 Java 已经是一种冗长的语言，它也必须变得更加冗长以提供无缝集成。

###  3.2. 示例应用程序

让我们从一个标准的 JVM 应用程序开始，我们假设一个简单的java.util.HashMap包含我们想要使用的大部分信息：

```java
public class MyApp {
    public static void main(String args[]) {
        Map map = new HashMap();
        map.put("health", 60);
        map.put("strength", 4);
        map.put("tools", Arrays.asList("hammer"));
        map.put("places", Arrays.asList("savannah","tundra"));
        map.put("location-x", -42 );
        map.put("location-y", 32);
 
        // paste original code from nudge4j below
        (new java.util.function.Consumer<Object[]>() {
            public void accept(Object args[]) {
                ...
                ...
            }
        }).accept(new Object[] { 
            5050,  // <-- the port
            map    // <-- the map is passed as a parameter.
        });
    }
}
```

从此示例中可以看出，你只需将nudge4j片段粘贴到你自己的代码末尾即可。此处示例中的第 12-20 行用作代码片段缩写版本的占位符。

现在，让我们将浏览器指向http://localhost:5050/。地图现在可以在浏览器的编辑器中作为args[1]访问，只需键入：

```java
args[1];
```

这将提供我们的Map的摘要(在本例中依赖于Map的toString()方法及其键和值)。

假设我们要检查和修改键值为“tools”的Map条目。

要获取Map中所有可用工具的列表，你可以编写：

```java
map = args[1];
map.get("tools");
```

要向 Map 添加一个新工具，你可以这样写：

```java
map = args[1];
map.get("tools").add("axe");
```

通常，几行代码就足以探测任何 Java 应用程序。

##  4。总结

通过在 JDK(Nashorn和Http 服务器)中组合两个简单的 API， nudge4j使你能够探测任何 Java 8 应用程序。

在某种程度上，nudge4j只是一个旧想法的现代截断：让开发人员通过脚本语言访问现有系统的设施——这个想法可以对 Java 开发人员如何度过一天的编码产生影响。
